---
description: threads í¬ë¡¤ëŸ¬ë¥¼ ìˆ˜ì •í•  ë•Œ ì°¸ê³ í•˜ì„¸ìš”
globs:
alwaysApply: false
---
# Threads í¬ë¡¤ëŸ¬ ê°€ì´ë“œ

Metaì˜ Threads í”Œë«í¼ì—ì„œ ê²Œì‹œê¸€ì„ í¬ë¡¤ë§í•˜ëŠ” ì‹œìŠ¤í…œì— ëŒ€í•œ ì¢…í•© ê°€ì´ë“œì…ë‹ˆë‹¤.

## ğŸ“ íŒŒì¼ êµ¬ì¡°

### í•µì‹¬ íŒŒì¼ë“¤
- [src/crawlers/threads.py](mdc:src/crawlers/threads.py) - Threads ì „ìš© í¬ë¡¤ëŸ¬ (ë¦¬íŒ©í† ë§ ì™„ë£Œ)
- [src/crawlers/base.py](mdc:src/crawlers/base.py) - ëª¨ë“  í¬ë¡¤ëŸ¬ì˜ ë² ì´ìŠ¤ í´ë˜ìŠ¤
- [main.py](mdc:main.py) - CLI ì¸í„°í˜ì´ìŠ¤
- [src/models.py](mdc:src/models.py) - ë°ì´í„° ëª¨ë¸ ì •ì˜

### ì„¤ì • íŒŒì¼ë“¤
- `.env` - í™˜ê²½ ë³€ìˆ˜ (ë¡œê·¸ì¸ ì •ë³´)
- `data/threads_session.json` - ì„¸ì…˜ ìƒíƒœ ì €ì¥

## ğŸŒ Threads ì›¹ì‚¬ì´íŠ¸ êµ¬ì¡°

### URL íŒ¨í„´
```
https://threads.net/ - ë©”ì¸ í”¼ë“œ
https://threads.net/login - ë¡œê·¸ì¸ í˜ì´ì§€
https://www.instagram.com/accounts/login/ - Instagram ë¡œê·¸ì¸ í˜ì´ì§€
https://threads.net/@username/post/POST_ID - ê°œë³„ ê²Œì‹œê¸€
```

### DOM êµ¬ì¡° íŠ¹ì„± (2024ë…„ 12ì›” ì—…ë°ì´íŠ¸)
```html
<!-- ë¡œê·¸ì¸ ë²„íŠ¼ -->
<div role="button" tabindex="0">Continue with Instagram</div>

<!-- ê²Œì‹œê¸€ ì»¨í…Œì´ë„ˆ (ì•ˆì •ì ì¸ ì„ íƒì) -->
<div data-pressable-container="true">
  <!-- ì‘ì„±ì ë§í¬ (href íŒ¨í„´ ê¸°ë°˜) -->
  <a href="/@username">username</a>

  <!-- ê²Œì‹œ ì‹œê°„ (semantic íƒœê·¸) -->
  <time datetime="2024-01-01T12:00:00.000Z">1h</time>

  <!-- ì½˜í…ì¸  (í…ìŠ¤íŠ¸ ë¶„ì„ ê¸°ë°˜) -->
  <span>ê²Œì‹œê¸€ ë‚´ìš©</span>

  <!-- ìƒí˜¸ì‘ìš© ë²„íŠ¼ë“¤ (aria-label ê¸°ë°˜) -->
  <svg aria-label="Like">...</svg>
  <span>18</span> <!-- ì¢‹ì•„ìš” ìˆ˜ -->

  <svg aria-label="Comment">...</svg>
  <span>4</span> <!-- ëŒ“ê¸€ ìˆ˜ -->

  <svg aria-label="Repost">...</svg>
  <span>2</span> <!-- ë¦¬í¬ìŠ¤íŠ¸ ìˆ˜ -->

  <svg aria-label="Share">...</svg>
  <span>1</span> <!-- ê³µìœ  ìˆ˜ -->
</div>

<!-- ë¡œê·¸ì¸ëœ ìƒíƒœ ì§€í‘œ -->
<div role="button">What's new?</div>
<div role="button">Post</div>
<text>For you</text>
```

## ğŸ”„ í¬ë¡¤ë§ í”„ë¡œì„¸ìŠ¤ íë¦„ë„

```mermaid
graph TD
    A[ì‹œì‘] --> B[í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ]
    B --> C[ì„¸ì…˜ íŒŒì¼ í™•ì¸]
    C --> D{ì„¸ì…˜ ì¡´ì¬?}

    D -->|Yes| E[ì„¸ì…˜ ë¡œë“œ ì‹œë„]
    D -->|No| F[ìƒˆ ë¡œê·¸ì¸ í•„ìš”]

    E --> G{ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸}
    G -->|Success| H[í”¼ë“œ í˜ì´ì§€ ì´ë™]
    G -->|Failed| F

    F --> I[ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­]
    I --> J[Instagram í˜ì´ì§€ ì´ë™]
    J --> K[ê³„ì • ì •ë³´ ì…ë ¥]
    K --> L[ë¡œê·¸ì¸ ì²˜ë¦¬]
    L --> M{Save info í™”ë©´?}

    M -->|Yes| N[Save info í´ë¦­]
    M -->|No| O[ë¡œê·¸ì¸ ì™„ë£Œ í™•ì¸]
    N --> P[5ì´ˆ ëŒ€ê¸°]
    P --> O

    O --> Q[ì„¸ì…˜ ì €ì¥]
    Q --> H

    H --> R[ì ì§„ì  ê²Œì‹œê¸€ ì¶”ì¶œ]
    R --> S[data-pressable-container íƒìƒ‰]
    S --> T[aria-label ê¸°ë°˜ ìƒí˜¸ì‘ìš© ì¶”ì¶œ]
    T --> U[JSON ì €ì¥]
    U --> V[ì™„ë£Œ]
```

## âš™ï¸ ì£¼ìš” ì„¤ì •

### í™˜ê²½ ë³€ìˆ˜ (.env)
```bash
THREADS_USERNAME=your_instagram_username
THREADS_PASSWORD=your_instagram_password
THREADS_USER_AGENT=Mozilla/5.0 (Windows NT 10.0; Win64; x64)...
THREADS_DEBUG_MODE=false  # ë””ë²„ê·¸ ê¸°ëŠ¥ ê°„ì†Œí™”ë¨
```

### í¬ë¡¤ëŸ¬ ì„¤ì •
- **User-Agent**: ë°ìŠ¤í¬í†± Chrome (ëª¨ë°”ì¼ UI ë¬¸ì œ ë°©ì§€)
- **ì„¸ì…˜ ê´€ë¦¬**: Storage State ê¸°ë°˜
- **íƒ€ì„ì•„ì›ƒ**: ë¡œê·¸ì¸ 30ì´ˆ, í˜ì´ì§€ ë¡œë“œ 15ì´ˆ
- **ì½”ë“œ í¬ê¸°**: 1609ì¤„ â†’ 700ì¤„ (56% ê°ì†Œ)

## ğŸš¨ ìì£¼ ë°œìƒí•˜ëŠ” ì—ëŸ¬ì™€ í•´ê²°ì±…

### 1. ë¡œê·¸ì¸ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ
**ì¦ìƒ**: `âŒ ë¡œê·¸ì¸ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`

**ì›ì¸**:
- ì˜ëª»ëœ User-Agent (ëª¨ë°”ì¼ vs ë°ìŠ¤í¬í†±)
- ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœ
- ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë¬¸ì œ

**í•´ê²°ì±…**:
```bash
# ë””ë²„ê·¸ ëª¨ë“œë¡œ ì‹¤í–‰ (ê°„ì†Œí™”ëœ ì¶œë ¥)
python main.py threads --debug

# í™˜ê²½ ë³€ìˆ˜ í™•ì¸
echo $THREADS_USER_AGENT
```

### 2. ì„¸ì…˜ ë¡œë“œ ì‹¤íŒ¨
**ì¦ìƒ**: `âš ï¸ ì„¸ì…˜ ë¡œë“œ ì¤‘ ì˜¤ë¥˜`

**ì›ì¸**:
- localStorage ì ‘ê·¼ ê¶Œí•œ ë¬¸ì œ
- ì†ìƒëœ ì„¸ì…˜ íŒŒì¼

**í•´ê²°ì±…**:
```bash
# ì„¸ì…˜ íŒŒì¼ ì‚­ì œ í›„ ì¬ë¡œê·¸ì¸
rm data/threads_session.json
python main.py threads --debug
```

### 3. ê²Œì‹œê¸€ ì¶”ì¶œ ì‹¤íŒ¨
**ì¦ìƒ**: `ğŸ“Š ì ì§„ì  ì¶”ì¶œ ì™„ë£Œ: 0ê°œ ê²Œì‹œê¸€ ìˆ˜ì§‘`

**ì›ì¸**:
- DOM êµ¬ì¡° ë³€ê²½
- ë¡œê·¸ì¸ ìƒíƒœ ë¶ˆì•ˆì •
- ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ

**í•´ê²°ì±…**:
1. ë¡œê·¸ì¸ ìƒíƒœ ì¬í™•ì¸
2. data-pressable-container ì„ íƒì í™•ì¸
3. ëŒ€ì•ˆ ì„ íƒìë¡œ fallback

### 4. ìƒí˜¸ì‘ìš© ì¶”ì¶œ ì‹¤íŒ¨
**ì¦ìƒ**: ëª¨ë“  ìƒí˜¸ì‘ìš©ì´ 0ìœ¼ë¡œ í‘œì‹œ

**ì›ì¸**:
- aria-label ì†ì„± ë³€ê²½
- ìˆ«ì í‘œì‹œ ë°©ì‹ ë³€ê²½

**í•´ê²°ì±…**:
1. SVG aria-label í™•ì¸: `Like`, `Comment`, `Reply`, `Repost`, `Share`
2. ìˆ«ì span êµ¬ì¡° í™•ì¸
3. ëŒ€ì•ˆ í…ìŠ¤íŠ¸ ì¶”ì¶œ ë°©ì‹ ì ìš©

## ğŸ”§ ì½”ë“œ ìˆ˜ì • ê°€ì´ë“œ

### ìƒˆë¡œìš´ ì„ íƒì ì¶”ê°€ (ì•ˆì •ì„± ìš°ì„ ìˆœìœ„ ì ìš©)
```python
# 1ìˆœìœ„: data ì†ì„±
post_containers = await page.query_selector_all('div[data-pressable-container="true"]')

# 2ìˆœìœ„: aria-label
svg_buttons = await element.query_selector('svg[aria-label="Like"]')

# 3ìˆœìœ„: semantic tags
time_elements = await element.query_selector('time[datetime]')

# 4ìˆœìœ„: href íŒ¨í„´
author_links = await element.query_selector_all('a[href*="/@"]:not([href*="/post/"])')
```

### ìƒí˜¸ì‘ìš© ì¶”ì¶œ ë¡œì§ ìˆ˜ì •
```python
interaction_types = [
    ("Like", "likes"),
    ("Comment", "comments"),
    ("Reply", "comments"),  # Commentì™€ ë™ì¼í•œ í•„ë“œ
    ("Repost", "reposts"),  # ë³„ë„ í•„ë“œ
    ("Share", "shares"),    # ë³„ë„ í•„ë“œ
]

for aria_label, field_name in interaction_types:
    svg = await element.query_selector(f'svg[aria-label="{aria_label}"]')
    if svg:
        # ë²„íŠ¼ì—ì„œ ìˆ«ì ì¶”ì¶œ ë¡œì§
        number_text = await button.evaluate("""...""")
        interactions[field_name] = self._parse_interaction_count(number_text)
```

### ì ì§„ì  ì¶”ì¶œ ë¡œì§
```python
async def _extract_posts_incrementally(self, page, target_count):
    all_posts = []
    extracted_urls = set()

    for scroll_round in range(max_scroll_attempts):
        current_elements = await self._find_current_post_elements(page)

        for element in current_elements:
            post_data = await self._extract_post_data(element)
            post_id = self._generate_post_id(post_data)

            if post_id not in extracted_urls and self._is_valid_post(post_data):
                all_posts.append(post_data)
                extracted_urls.add(post_id)

        if len(all_posts) >= target_count:
            break

        await self._perform_scroll(page)
```

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### í¬ë¡¤ë§ ì†ë„ ê°œì„ 
1. **ì ì§„ì  ì¶”ì¶œ**: ìŠ¤í¬ë¡¤ ì¤‘ DOM ìš”ì†Œ ì œê±° ë¬¸ì œ í•´ê²°
2. **ì„ íƒì ìµœì í™”**: data ì†ì„± ìš°ì„  ì‚¬ìš©ìœ¼ë¡œ ì•ˆì •ì„± í–¥ìƒ
3. **ì½”ë“œ ê°„ì†Œí™”**: ë¶ˆí•„ìš”í•œ ë””ë²„ê·¸ ì½”ë“œ ì œê±°ë¡œ 56% í¬ê¸° ê°ì†Œ

### ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì í™”
1. **ì‹¤ì‹œê°„ ì²˜ë¦¬**: ê²Œì‹œê¸€ë³„ ì¦‰ì‹œ ì²˜ë¦¬ë¡œ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±
2. **ì¤‘ë³µ ì œê±°**: ê³ ìœ  ID ê¸°ë°˜ ì¤‘ë³µ ë°©ì§€
3. **ì˜ˆì™¸ ì²˜ë¦¬ ê°„ì†Œí™”**: í•µì‹¬ ì˜ˆì™¸ë§Œ ì²˜ë¦¬

## ğŸ¯ ì£¼ìš” ê°œì„ ì‚¬í•­ ìš”ì•½

### Before vs After
| í•­ëª© | Before | After |
|------|--------|-------|
| ì½”ë“œ ë¼ì¸ ìˆ˜ | 1609ì¤„ | ~700ì¤„ |
| ë””ë²„ê·¸ ë©”ì„œë“œ | 3ê°œ (ë³µì¡) | 0ê°œ (ê°„ì†Œí™”) |
| ì„ íƒì ìš°ì„ ìˆœìœ„ | í´ë˜ìŠ¤ ê¸°ë°˜ | data ì†ì„± ê¸°ë°˜ |
| ìƒí˜¸ì‘ìš© êµ¬ë¶„ | sharesë§Œ | reposts + shares |
| ì¶”ì¶œ ë°©ì‹ | ì¼ê´„ ì²˜ë¦¬ | ì ì§„ì  ì²˜ë¦¬ |
| ì—ëŸ¬ ì²˜ë¦¬ | ìƒì„¸ ë¡œê·¸ | í•µì‹¬ ì •ë³´ë§Œ |

### ìƒˆë¡œìš´ ê¸°ëŠ¥
- âœ… Repostì™€ Share ì •í™•í•œ êµ¬ë¶„
- âœ… í´ë˜ìŠ¤ ì´ë¦„ ì˜ì¡´ì„± ì œê±°
- âœ… ì ì§„ì  ì¶”ì¶œë¡œ ì•ˆì •ì„± í–¥ìƒ
- âœ… ê°„ì†Œí™”ëœ ë””ë²„ê·¸ ëª¨ë“œ
- âœ… ë” ë‚˜ì€ ì¤‘ë³µ ë°©ì§€ ì‹œìŠ¤í…œ

## ğŸš€ ì‹¤í–‰ ê°€ì´ë“œ

### ì²« ì‹¤í–‰
```bash
# í™˜ê²½ ì„¤ì •
cp .env.example .env
# .env íŒŒì¼ì— ê³„ì • ì •ë³´ ì…ë ¥

# ì²« í¬ë¡¤ë§ (ê°„ì†Œí™”ëœ ë””ë²„ê·¸ ëª¨ë“œ)
python main.py threads --count 5 --debug
```

### ì •ê¸° ì‹¤í–‰
```bash
# ì¼ë°˜ ëª¨ë“œ (ë¹ ë¥¸ ì‹¤í–‰)
python main.py threads --count 20

# ì¶œë ¥ íŒŒì¼ ì§€ì •
python main.py threads --count 10 --output my_threads.json
```

### íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
```bash
# ì„¸ì…˜ ì´ˆê¸°í™”
rm data/threads_session.json

# ìƒí˜¸ì‘ìš© ì¶”ì¶œ í™•ì¸
python main.py threads --count 3 --debug | grep "ì¶”ì¶œ:"

# DOM êµ¬ì¡° í™•ì¸ì´ í•„ìš”í•œ ê²½ìš°
# ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ì—ì„œ ë‹¤ìŒ í™•ì¸:
# - div[data-pressable-container="true"]
# - svg[aria-label="Like"], svg[aria-label="Repost"], svg[aria-label="Share"]
# - a[href*="/@"]:not([href*="/post/"])
```

## ğŸ”§ í•µì‹¬ ê¸°ìˆ  ê°œì„ ì‚¬í•­ (2024ë…„ 12ì›”)

### 1. ì•ˆì •ì ì¸ ì„ íƒì ìš°ì„ ìˆœìœ„
```python
# ìš°ì„ ìˆœìœ„: data ì†ì„± > aria-label > semantic tags > êµ¬ì¡°ì  ê´€ê³„ > í´ë˜ìŠ¤ ì´ë¦„
post_containers = await page.query_selector_all('div[data-pressable-container="true"]')
author_links = await element.query_selector_all('a[href*="/@"]:not([href*="/post/"])')
interaction_svgs = await element.query_selector('svg[aria-label="Like"]')
```

### 2. Repostì™€ Share êµ¬ë¶„
```python
interactions = {
    "likes": 0,      # svg[aria-label="Like"]
    "comments": 0,   # svg[aria-label="Comment"] ë˜ëŠ” svg[aria-label="Reply"]
    "reposts": 0,    # svg[aria-label="Repost"]
    "shares": 0,     # svg[aria-label="Share"]
}
```

### 3. ì ì§„ì  ì¶”ì¶œ ì‹œìŠ¤í…œ
- DOM ìš”ì†Œ ì œê±° ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ ì‹¤ì‹œê°„ ì¶”ì¶œ
- ìŠ¤í¬ë¡¤ ë¼ìš´ë“œë³„ ìƒˆ ê²Œì‹œê¸€ íƒì§€
- ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•œ ê³ ìœ  ID ìƒì„±

### 4. ê°„ì†Œí™”ëœ ë””ë²„ê·¸ ëª¨ë“œ
- ë¶ˆí•„ìš”í•œ ìŠ¤í¬ë¦°ìƒ· ê¸°ëŠ¥ ì œê±°
- í•µì‹¬ ì •ë³´ë§Œ ì¶œë ¥
- ì„±ëŠ¥ ìµœì í™”
